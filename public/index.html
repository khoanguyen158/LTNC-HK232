<!-- 
ĐÂY LÀ TRANG ĐĂNG NHẬP
 -->


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elearning</title>
    <link rel="stylesheet" href="style-index.css">
</head>

<body>
    
    <div id="page">
        <div class="logo">
            <ion-icon name="logo-react"></ion-icon>
        </div>
        <div class="content">
            <div class="left">
                <div class="title">
                    <h1></h1>
                </div>
                <p>Trường Đại Học DEF
                </p>
            </div>
            <div class="right">
                <form id="MainForm">
                    <h1>LOGIN</h1>
                    <input type="text" id="emailInp" class="input-field" placeholder="Email">
                    <input type="text" id="idInp" class="input-field" placeholder="ID: (SV/GV/QTV)_(number)">
                    <input type="password" id="passwordInp" class="input-field" placeholder="Password">
                    <div>
                        <input type="checkbox" id="showPasswordCheckbox">
                        <h5>Show Password</h5></div>
                    <div id="forgotpasslabel" class="forgot-pass">Quên mật khẩu?</div>
                    <input type="submit" value="LOGIN">
                </form>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, get, ref, child } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDQk0PGIztg7qltOimH1_9_lLl5rluKsV8",
            authDomain: "fir-d023a.firebaseapp.com",
            databaseURL: "https://fir-d023a-default-rtdb.firebaseio.com",
            projectId: "fir-d023a",
            storageBucket: "fir-d023a.appspot.com",
            messagingSenderId: "81322751429",
            appId: "1:81322751429:web:eeb12e1ec56b1970c807ac",
            measurementId: "G-KZQQJNVVWJ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const auth = getAuth(app);
        const dbref = ref(db);


        let EmailInp = document.getElementById('emailInp');
        let IdInp = document.getElementById('idInp');
        let PassInp = document.getElementById('passwordInp');
        let MainForm = document.getElementById('MainForm');

        let ForgotPassLabel = document.getElementById('forgotpasslabel');



        let SignInUser = evt => {
            evt.preventDefault();
            signInWithEmailAndPassword(auth, EmailInp.value, PassInp.value)
                .then((credentials) => {
                    get(child(dbref, 'SinhVien/' + IdInp.value)).then((snapshot) => {
                        if (snapshot.exists()) {
                            sessionStorage.setItem("user-info", JSON.stringify({
                                username: snapshot.val().username,
                                email: snapshot.val().email,
                                password: snapshot.val().password,
                                id: snapshot.val().id
                            }))
                            sessionStorage.setItem("user-creds", JSON.stringify(credentials.user));
                            window.location.href = "Home.html";
                        }
                    })

                    get(child(dbref, 'GiangVien/' + IdInp.value)).then((snapshot) => {
                        if (snapshot.exists()) {
                            sessionStorage.setItem("user-info", JSON.stringify({
                                username: snapshot.val().username,
                                email: snapshot.val().email,
                                password: snapshot.val().password,
                                id: snapshot.val().id
                            }))
                            sessionStorage.setItem("user-creds", JSON.stringify(credentials.user));
                            window.location.href = "HomeGV.html";
                        }
                    })

                    get(child(dbref, 'QuanTriVien/' + IdInp.value)).then((snapshot) => {
                        if (snapshot.exists()) {
                            sessionStorage.setItem("user-info", JSON.stringify({
                                username: snapshot.val().username,
                                email: snapshot.val().email,
                                password: snapshot.val().password,
                                id: snapshot.val().id
                            }))
                            sessionStorage.setItem("user-creds", JSON.stringify(credentials.user));
                            window.location.href = "HomeQTV.html";
                        }
                    })

                })
                .catch((error) => {
                    alert("Sai tên đăng nhập hoặc mật khẩu!");
                    console.log(error.code);
                    console.log(error.message);
                });

        }



        let ForgotPassword = () => {
            sendPasswordResetEmail(auth, EmailInp.value)
                .then(() => {
                    alert("Kiểm tra email của bạn để đặt lại mật khẩu!"); 
                })
                .catch((error) => {
                    alert(error.message);
                    console.log(error.code);
                    console.log(error.message);
                });
        }

        MainForm.addEventListener('submit', SignInUser);
        ForgotPassLabel.addEventListener('click', ForgotPassword);
    </script>
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
</body>

</html>